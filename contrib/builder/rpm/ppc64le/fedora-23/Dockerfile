#
# THIS FILE IS AUTOGENERATED; SEE "contrib/builder/rpm/ppc64le/generate.sh"!
#

FROM ppc64le/fedora:23

RUN sed -i "s|proxy=http://proxy:3128||" /etc/dnf/dnf.conf
RUN dnf install -y @development-tools fedora-packager
RUN dnf install -y btrfs-progs-devel device-mapper-devel glibc-static libseccomp-devel libselinux-devel libtool-ltdl-devel pkgconfig selinux-policy selinux-policy-devel sqlite-devel systemd-devel tar git

# Install Go
# go doesn't currently ship in any of the deb-based distros that ship docker for ppc64le, so just bootstrap
# GO_VERSION using IBM AT9's version.
RUN curl -fSL ftp://ftp.unicamp.br/pub/linuxpatch/toolchain/at/redhat/Fedora22/at9.0/advance-toolchain-at9.0-golang-9.0-3.ppc64le.rpm -o at9-golang.ppc64le.rpm \
    && dnf install -y at9-golang.ppc64le.rpm \
    && rm -f at9-golang.ppc64le.rpm
ENV PATH=/usr/local/go/bin:$PATH

# NOTE: ppc64le has compatibility issues with older versions of go, so make sure the version >= 1.6
ENV GO_VERSION 1.7.3
ENV GO_DOWNLOAD_URL "https://storage.googleapis.com/golang/go${GO_VERSION}.src.tar.gz"
ENV GOROOT_BOOTSTRAP /usr/local/go

RUN curl -fsSL "$GO_DOWNLOAD_URL" -o golang.tar.gz \
  && tar -C /tmp -xzf golang.tar.gz \
  && rm golang.tar.gz \
  && cd /tmp/go/src && GOROOT_FINAL=/usr/local/go ./make.bash 2>&1 \
  && yum remove -y advance-toolchain-at9.0-golang \
  && cp -r /tmp/go/bin /usr/local/go/ \
  && rm -rf /tmp/go

ENV GOPATH /go:/go/src/github.com/docker/docker/vendor/

ENV DOCKER_BUILDTAGS pkcs11 seccomp selinux
ENV RUNC_BUILDTAGS seccomp selinux

